---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import Header from '../../components/Header.astro';
import { SITE_DESCRIPTION, SITE_SEO_TITLE } from '../../consts';

const base = import.meta.env.BASE_URL;

const posts = (await getCollection('blog')).sort(
(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
const year = post.data.pubDate.getFullYear();
if (!acc[year]) acc[year] = [];
acc[year].push(post);
return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).sort((a, b) => Number(b) - Number(a));
---

<!doctype html>
<html lang="en">
<head>
<BaseHead title={`Beijerblog | ${SITE_SEO_TITLE}`} description={SITE_DESCRIPTION} />
<style>
main {
width: 760px;
}
h2.year {
margin-top: 2rem;
margin-bottom: 0.5rem;
padding-bottom: 0.25rem;
border-bottom: 1px solid rgb(var(--border));
}
h2.year:first-of-type {
margin-top: 1rem;
}
ul {
list-style-type: disc;
margin-left: 1.25em;
margin: 0;
padding: 0;
}
ul li {
margin: 0.5rem 0;
}
ul li a {
text-decoration: none;
}
ul li a:hover {
text-decoration: underline;
}
.date {
color: rgb(var(--muted));
font-size: 0.9em;
}
</style>
</head>
<body>
<Header />
<main>
<section>
<h1>Beijerblog</h1>
{years.map((year) => (
<>
<h2 class="year">{year}</h2>
<ul>
{postsByYear[Number(year)].map((post) => (
<li>
<a href={base + 'blog/' + post.id + '/'}>
{post.data.title}
</a>
<span class="date"> ({post.data.pubDate.toLocaleDateString('en-GB', { month: 'short', day: 'numeric' })})</span>
</li>
))}
</ul>
</>
))}
</section>
</main>
<Footer />
</body>
</html>